import chess.svg

winner = False
score = 0
class Algorithms():
    def __init__(self, board1):
        self.board = board1

    def minimax(self, board, isMax, depth):
        global bestmove
        if(winner == True):
            return board
        if(depth == 0):
            return board

        if isMax:
            bestscore = -10000

            for move in board.legal_moves:

                currentMove = chess.Move.from_uci(str(move))
                game = chessGame(board)
                if (game.is_valid(currentMove)):
                    board.push(currentMove)
                    Algorithms(board).minimax(board, False, depth - 1)
                    if evaluateBoard(board) > bestscore:
                        bestscore = evaluateBoard(board)
                        bestmoveWhite = currentMove
                    board.pop()

            if (game.is_valid(currentMove)):
                board.push(bestmoveWhite)
            return board


        else:
            bestscore = 10000

            for move in board.legal_moves:
                currentMove = chess.Move.from_uci(str(move))
                game = chessGame(board)
                if (game.is_valid(currentMove)):
                    board.push(currentMove)
                    Algorithms(board).minimax(board, True, depth - 1)
                    if evaluateBoard(board) < bestscore:
                        bestscore = evaluateBoard(board)
                        bestmoveBlack = currentMove
                    board.pop()
            if (game.is_valid(currentMove)):
                board.push(bestmoveBlack)
            return board



class chessGame():
    def __init__(self, board):
        self.board = board
        self = self

    # might remove, doesn't do anything rn
    def is_valid(self, move):
        legal_moves = list(board.legal_moves)  # creates list of legal moves
        for moves in legal_moves:  # checks if move is legal
            if moves == Nf3:
                return True
        return False


def evaluateBoard(board):
    count = 0
    # can't move your own king into checkmate, so this will return 1000 for a winning move for whoevers turn it is
    if board.is_checkmate():
        global winner
        winner = True
        if board.turn == False:  # return 1000 if white went last
            count += 1000
        else:  # return -1000 if black went last
            count -= 1000

    for s in range(64):
        # capital letters = white, lowercase = black
        piece = board.piece_at(getattr(chess, all_squares[s]))
        if str(piece) == 'P':
            count += 10
        elif str(piece) == 'p':
            count -= 10
        elif str(piece) == 'B' or str(piece) == 'N':
            count += 30
        elif str(piece) == 'b' or str(piece) == 'n':
            count -= 30
        elif str(piece) == 'R':
            count += 50
        elif str(piece) == 'r':
            count -= 50
        elif str(piece) == 'Q':
            count += 100
        elif str(piece) == 'q':
            count -= 100
        if s in (18, 19, 20, 21, 26, 27, 28, 29, 34, 35, 36, 37, 42, 43, 44, 45): #checks center squares (center control good)
            if str(piece) == 'P':
                count += 1
            elif str(piece) == 'p':
                count -= 1
            elif str(piece) == 'B':
                count += 2
            elif str(piece) == 'b':
                count -= 2
            elif str(piece) == 'N':
                count += 5
            elif str(piece) == 'n':
                count -= 5
            elif str(piece) == 'Q':
                count += 4
            elif str(piece) == 'q':
                count -= 4
    #TO DO: add hueristics for rook placement, castling, and fiencetto bishop
    return count


board = chess.Board()

Nf3 = chess.Move.from_uci("b1c3")
game = chessGame(board)
#if (game.is_valid(Nf3)):
 #   board.push(Nf3)  # Make the move
#board.pop()  # Unmake the last move
squares = (chess.A1, chess.A2)  # oh lord
#print(chess.RANK_NAMES + chess.FILE_NAMES)
# all_squares holds all squares
all_squares = []
for i in range(8):
    for j in range(8):
        all_squares.append((chess.FILE_NAMES[i].upper() + chess.RANK_NAMES[j]))
# for i in all_squares:
# print(i)
piece = board.piece_at(getattr(chess, all_squares[1]))
#print(list(board.legal_moves))
AI = Algorithms(board)
AI.minimax(board, True, 6)
print(board)
print(evaluateBoard(board))



# displays gui in svg file
board_svg = chess.svg.board(board, size=350)
output_file = open('test.svg', "w")
output_file.write(board_svg)
output_file.close()
